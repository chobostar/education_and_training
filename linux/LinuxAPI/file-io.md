# Файловый ввод-вывод: универсальная модель ввода-вывода

Все системные вызовы для ввода-вывода совершаются в отношении открытых файлов с использованием дескриптора файла.

open() - чтобы выполнить ввод/вывод в отношении обычного файла, сначала нужно получить его дескриптор.

Стандартные дескрипторы файлов:
- 0 Стандартный ввод STDIN_FILENO stdin
- 1 Стандартный вывод STDOUT_FILENO stdout
- 2 Стандартная ошибка STDERR_FILENO stderr

syscalls:
- fd = open(pathname, flags, mode)
- numread = read(fd, buffer, count) - Если данные не могут быть считаны (то есть встретился конец файла), read() возвращает 0.
- numwritten = write(fd, buffer, count)
- status = close(fd) — вызывается после завершения ввода-вывода с целью высвобождения дескриптора файла fd и связанных с ним ресурсов ядра.

Поскольку детали реализации конкретной файловой системы или устройства обрабатываются внутри ядра, при написании прикладных программ мы можем вообще игнорировать факторы, относящиеся к устройству.

write() - Для дискового файла возможными причинами такой частичной записи может оказаться переполнение диска или достижение ограничения ресурса процесса на размеры файла (RLIMIT_FSIZE).

(close(fd) == -1) - Пример: когда в NFS происходит сбой завершения транзакции, означающий, что данные не достигли удаленного диска, эта ошибка доходит до прило-
жения в виде сбоя системного вызова close().

lseek() устанавливает файловое смещение открытого файла, на который указывает дескриптор fd, в соответствии со значениями, заданными в аргументах offset и whence.

off_t lseek(int fd, off_t offset, int whence);

Запрещено применение lseek() к конвейеру, FIFO-устройству, сокету или терминалу — вызов аварийно завершится с установленным для errno значением ESPIPE.